<!DOCTYPE html>
<html>

<head>
  <base target="_top">
  <link href="https://gcore.jsdelivr.net/npm/bootstrap@5.0.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://gcore.jsdelivr.net/npm/bootstrap@5.0.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
  <script
    src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
  <?!= include_('approvals/css.html') ?>
</head>

<body>
  <div id="app">
    <div class="app-header <?= status === rejected ? 'red-bg' : '' ?>">
      <h1>
        <?= title ?>
      </h1>
    </div>
    <? if (task) { ?>
    <div class="app-content">
      <div class="left">
        <h3 class="section">Approval Request</h3>
        <div class="section">
          <ul class="list">
            <? task.forEach( item => { ?>
            <li>
              <label>
                <?= item.label ?>
              </label>
              <div
                class="<?= item.value === pending ? 'yellow-text' :  item.value === approved ?  'green-text' : item.value === rejected ? 'red-text' : '' ?>">
                <?= item.value ?>
              </div>
            </li>
            <? }) ?>
          </ul>
        </div>
      </div>

      <div class="middle">
        <h3 class="section">Approval Flow</h3>
        <div class="section">
          <ul class="list">
            <? approvers.forEach((item, i) => { ?>
            <li>
              <label>
                <?= item.name + "(" + item.title + ")" ?>
              </label>
              <div
                class="<?= item.status === pending ? 'yellow-text' :  item.status === approved ?  'green-text' : item.status === rejected ? 'red-text' : '' ?>">
                <?= item.status ? item.status : 'Waiting' ?>
              </div>
            </li>
            <? }) ?>
          </ul>
        </div>
      </div>

      <div class="right">
        <h3 class="section">Current Approver</h3>
        <div class="section">
          <ul class="list">
            <li>
              <label>Name</label>
              <div>
                <?= approver.name?>
              </div>
            </li>
            <li>
              <label>Title</label>
              <div>
                <?= approver.title?>
              </div>
            </li>
            <li>
              <label>Email</label>
              <div>
                <?= approver.email?>
              </div>
            </li>
            <li>
              <label>Status</label>
              <div
                class="<?= approver.status === pending ? 'yellow-text' :  approver.status === approved ?  'green-text' : approver.status === rejected ? 'red-text' : '' ?>">
                <?= approver.status ? approver.status : 'Waiting' ?>
              </div>
            </li>
            <? if (approver.status !== "Pending") { ?>
            <? if (approver.comments) { ?>
            <li>
              <label>Comments</label>
              <div>
                <?= approver.comments ?>
              </div>
            </li>
            <? } ?>
            <? if (approver.timestamp) { ?>
            <li>
              <label>Timestamp</label>
              <div>
                <?= new Date(approver.timestamp).toLocaleString() ?>
              </div>
            </li>
            <? } ?>
            <? } ?>
          </ul>
        </div>

        <!-- <? if (approver.status === "Pending") { ?>
                <form id="approval-form-bmhr0202" data="<?= approver.taskId ?>" url="<?= url ?>">
                    <label for="comments">Comments (optional)</label>
                    <textarea id="comments" rows="4"></textarea>
                    <div class="button-set section">
                        <button id="approve" class="button green-bg">Approve</button>
                        <button id="reject" class="button red-bg">Reject</button>
                    </div>
                    <div id="prompt-message"></div>
                </form>
                <? } ?> -->

        <? if (approver.status === "Pending") { ?>
        <form id="approval-form-bmhr0202" data="<?= approver.taskId ?>" url="<?= url ?>">
          <label for="comments">Comments:</label>
          <textarea class="form-control" id="comments" name="comments"></textarea>
          <label for="newoffdate">Ngày làm việc cuối cùng sau khi thỏa thuận với nhân sự:</label>
          <div class="input-group date" id="datepicker">
            <input type="text" class="form-control" id="newoffdate" name="newoffdate">
            <span class="input-group-append">
              <span class="input-group-text bg-white d-block d-none">
                <i class="fa fa-calendar d-none"></i>
              </span>
            </span>
          </div>

          <div class="button-set section">
            <button id="approve" class="button green-bg">Approve</button>
            <button id="reject" class="button red-bg">Reject</button>
          </div>
          <div id="prompt-message"></div>
        </form>
        <? } ?>

      </div>
    </div>
    <? } else { ?>
    <div class="app-content">
      <h2 class="red-text">No Record Found</h2>
    </div>
    <? } ?>
  </div>

  <script type="text/javascript">
    $(function () {
      $('#datepicker').datepicker({
        format: 'dd/mm/yyyy'
      });
    });
  </script>

  <?!= include_("approvals/resignform/js.html") ?>

</body>

</html>