<script>
  window.onload = () => {
    const commentsTextarea = document.getElementById("comments")
    const newOffDate = document.getElementById("newoffdate")
    const approveButton = document.getElementById("approve")
    const rejectButton = document.getElementById("reject")
    const promptDiv = document.getElementById("prompt-message")
    const formApproval = document.getElementById("approval-form-bmhr0202")
    
    const disableForm = (status) => {
      formApproval.disabled = status
      approveButton.disabled = status
      rejectButton.disabled = status
      commentsTextarea.disabled = status
      newOffDate.disabled = status
    }
    
    if (formApproval){
      const taskId = formApproval.getAttribute("data")
      const url = formApproval.getAttribute("url")
      approveButton.addEventListener("click", (e) => {
        e.preventDefault()
        disableForm(true)
        promptDiv.innerHTML = `<label>Submitting...</label>`
        const comments = commentsTextarea.value
        const newoffdate = newOffDate.value
        google.script.run
        .withSuccessHandler(()=>{
          promptDiv.innerHTML = `<label class='green-text'>Approved</label>`
          // window.open(url, "_top")
        })
        .withFailureHandler((error) => {
          disableForm(true)
          promptDiv.innerHTML = `<label class='green-text'>Approved</label>`
        })
        .approve({taskId, comments, newoffdate})
      })
          
      rejectButton.addEventListener("click", (e) => {
        e.preventDefault()
        disableForm(true)
        promptDiv.innerHTML = `<label>Submitting...</label>`
        const comments = commentsTextarea.value
        const newoffdate = newOffDate.value
        google.script.run
        .withSuccessHandler(()=>{
          promptDiv.innerHTML = `<label class='red-text'>Rejected</label>`
          // window.open(url, "_top")
        })
        .withFailureHandler((error) => {
          disableForm(false)
          promptDiv.innerHTML = `<label class='red-text'>${error.message}</label>`
        })
        .reject({taskId, comments, newoffdate})
      })
    }
  }

</script>